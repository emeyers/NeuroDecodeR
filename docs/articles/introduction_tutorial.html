<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introductory tutorial • NeuroDecodeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introductory tutorial">
<meta property="og:description" content="NeuroDecodeR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">NeuroDecodeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction_tutorial.html">Introductory tutorial</a>
    </li>
    <li>
      <a href="../articles/generalization_tutorial.html">Generalization analysis tutorial</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Documentation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_formats.html">Data formats</a>
    </li>
    <li>
      <a href="../articles/datasets.html">Datasets</a>
    </li>
    <li>
      <a href="../articles/NDR_object_specification.html">NDR object specification</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/emeyers/NeuroDecodeR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introductory tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emeyers/NeuroDecodeR/blob/HEAD/vignettes/introduction_tutorial.Rmd" class="external-link"><code>vignettes/introduction_tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>introduction_tutorial.Rmd</code></div>

    </div>

    
    
<p>The following tutorial gives a basic introduction to the data formats
used by NeuroDecodeR (NDR) and shows how to run a simple decoding
analysis. The tutorial is based on a dataset collected by Ying Zhang in
Bob Desimone’s lab at MIT (some of the code below uses just a small
subset of this data, but a larger data set can be download from the
NeuroDecodeR GitHub site).</p>
<p>The NeuroDecodeR package is based on the MATLAB Neural Decoding
Toolbox, which you can learn more about at <a href="http://www.readout.info" class="external-link">www.readout.info</a>.</p>
<div class="section level2">
<h2 id="overview-of-the-ndr">Overview of the NDR<a class="anchor" aria-label="anchor" href="#overview-of-the-ndr"></a>
</h2>
<p>Neural decoding is a process in which a pattern classifier learns the
relationship between neural activity and experimental conditions using a
<em>training set</em> of data. The reliability of the relationship
between the neural activity and experimental conditions is evaluated by
having the classifier predict what experimental conditions were present
on a second <em>test set</em> of data.</p>
<p>The NDR is built around 5 different object classes that allow users
to apply neural decoding in a flexible and robust way. The four types of
objects are:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Datasources (DS)</strong> which generate training and
test splits of the data.</p></li>
<li><p><strong>Feature preprocessors (FP)</strong> which apply
preprocessing to the training and test splits.</p></li>
<li><p><strong>Classifiers (CL)</strong> which learn the relationship
between experimental conditions and data on the training set, and then
predict experimental conditions on the test data.</p></li>
<li><p><strong>Result Metrics (RM)</strong> which take the output
predictions of a classifier and summarize the prediction
accuracy.</p></li>
<li><p><strong>Cross-validators (CV)</strong> which take the DS, FP and
CL objects and run a cross-validation decoding procedure.</p></li>
</ol>
<p>The NDR comes with a few implementations of each of these objects,
and defines interfaces that allow one to create new objects that extend
the basic functionality of the five object classes. The following
tutorial explains the data formats used by the Neural Decoding Toolbox
and how to run a decoding experiment using the basic versions of the
four object classes.</p>
<div class="section level3">
<h3 id="about-the-data-used-in-this-tutorial">About the data used in this tutorial<a class="anchor" aria-label="anchor" href="#about-the-data-used-in-this-tutorial"></a>
</h3>
<p>The data used in this tutorial was collected by Ying Zhang in Bob
Desimone’s lab at MIT and was used in the supplemental figures in the
paper <a href="https://pubmed.ncbi.nlm.nih.gov/21555594/" class="external-link">Object
decoding with attention in inferior temporal cortex, PNAS, 2011</a>. The
data consists of single unit recordings from 132 neurons in inferior
temporal cortex (IT). The recordings were made while a monkey viewed 7
different objects that were presented at three different locations (the
monkey was also shown images that consisted of three objects shown
simultaneously and performed an attention task; however, for the
purposes of this tutorial, we are only going to analyze data from trials
when single objects were shown). Each object was presented approximately
20 times at each of the three locations.</p>
<p>To start, let us load some libraries we will use in this
tutorial.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emeyers.github.io/NeuroDecodeR/" class="external-link">NeuroDecodeR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="data-formats">Data formats<a class="anchor" aria-label="anchor" href="#data-formats"></a>
</h2>
<p>In order to use the NDR, the neural data must be in a usable format.
Typically, this involves putting the data in <a href="data_formats.html">raster format</a> and then converting it to <a href="data_formats.html">binned format</a> using the
<code><a href="../reference/create_binned_data.html">create_binned_data()</a></code> function.</p>
<div class="section level3">
<h3 id="raster-format">Raster format<a class="anchor" aria-label="anchor" href="#raster-format"></a>
</h3>
<p>To run a decoding analysis using the NDR, you first need to have your
data in a usable format. In this tutorial we will use data collected by
<a href="datasets.html">Ying Zhang in Bob Desimone’s lab at MIT</a>. The
directory extdata/Zhang_Desimone_7objects_raster_data_rda/ contains data
in raster format. Each file in this directory contains data from one
neuron. To start, let us load one of these files and examine its
contents.</p>
<p>We can also use the <code><a href="../reference/test_valid_raster_format.html">test_valid_raster_format()</a></code> method to
verify that the data is in valid raster format. If you start analyzing
your own data, <code><a href="../reference/test_valid_raster_format.html">test_valid_raster_format()</a></code> can be a useful
function to make sure you have your raster data in the correct
format.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raster_dir_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"NeuroDecodeR"</span><span class="op">)</span>,</span>
<span>                             <span class="st">"Zhang_Desimone_7object_raster_data_small_rda"</span><span class="op">)</span></span>
<span><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="st">"bp1001spk_01A_raster_data.rda"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">raster_dir_name</span>, <span class="va">file_name</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/test_valid_raster_format.html">test_valid_raster_format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">raster_dir_name</span>, <span class="va">file_name</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Below, we visualize the spiking pattern for this one neuron by using
the raster data’s <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">raster_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/plot_raster_file-1.png" width="700"></p>
<p>Here, the x-axis represents time in milliseconds, and the y-axis
represents different trials. Each black tick mark represents a point in
time when a neuron emitted an action potential.</p>
</div>
<div class="section level3">
<h3 id="binning-the-data">Binning the data<a class="anchor" aria-label="anchor" href="#binning-the-data"></a>
</h3>
<p>The NDR decoding objects operate on data in binned-format. To convert
data from raster-format to binned-format, we can use the function
<code><a href="../reference/create_binned_data.html">create_binned_data()</a></code>, which calculates the average firing
rate of neurons over specified intervals sampled with a specified
frequency (i.e., a boxcar filter is used).
<code><a href="../reference/create_binned_data.html">create_binned_data()</a></code> takes in four arguments:</p>
<ol style="list-style-type: decimal">
<li>The name of the directory where the raster-format data is
stored</li>
<li>The name (potentially including a directory path) that the binned
data should be saved as</li>
<li>A bin size that specifies how much time the firing rates should be
calculated over</li>
<li>A sampling interval that specifies how frequently to calculate these
firing rates.</li>
</ol>
<p>To calculate the average firing rates in 150 ms bins sampled every 50
ms, we can use the code below.</p>
<p>(Note: in the code below we have set the optional argument
<code>num_parallel_cores</code> to specify the number of parallel cores
we would like to use. Using more cores will speed up the time it takes
for this function to run. By default, half the cores on the computer
will be used which could be a good setting for most computers. We have
chosen 2 cores here since this is the maximum number of cores allowed
for examples that are on CRAN.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emeyers.github.io/NeuroDecodeR/" class="external-link">NeuroDecodeR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">save_dir_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">binned_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_binned_data.html">create_binned_data</a></span><span class="op">(</span><span class="va">raster_dir_name</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">save_dir_name</span>, <span class="st">"ZD"</span><span class="op">)</span>, </span>
<span>                                       <span class="fl">150</span>, <span class="fl">50</span>, num_parallel_cores <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="determining-how-many-times-each-condition-was-repeated">Determining how many times each condition was repeated<a class="anchor" aria-label="anchor" href="#determining-how-many-times-each-condition-was-repeated"></a>
</h3>
<p>Before beginning the decoding analysis, it is useful to know how many
times each experimental condition (e.g., stimulus) was presented to each
site (e.g., neuron). In particular, it is useful to know how many times
the condition that has the fewest repetitions was presented. To do this,
we will use the function <code><a href="../reference/get_num_label_repetitions.html">get_num_label_repetitions()</a></code> which
uses data in binned-format and calculates how many trials each label
level was presented.</p>
<p>Below, we use the plot function on the results to see how many times
the labels were repeated.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binned_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ZD_150bins_50sampled.Rda"</span><span class="op">)</span>, package<span class="op">=</span><span class="st">"NeuroDecodeR"</span><span class="op">)</span></span>
<span><span class="va">label_rep_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_num_label_repetitions.html">get_num_label_repetitions</a></span><span class="op">(</span><span class="va">binned_file_name</span>, <span class="st">"stimulus_ID"</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">label_rep_info</span><span class="op">)</span>  </span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/label_repetitions-1.png" width="700"></p>
<p>Here, we see there are 132 neurons which have 60 repetitions of all
the labels, and 6 neurons where the flower label was only presented 59
times. Thus, if we want to use all the neurons in the decoding analysis,
the maximum number of cross-validation splits we could use is 59.
Alternatively, we could use 60 cross-validation splits along with the
125 neurons that have 60 repetitions.</p>
</div>
</div>
<div class="section level2">
<h2 id="performing-a-decoding-analysis">Performing a decoding analysis<a class="anchor" aria-label="anchor" href="#performing-a-decoding-analysis"></a>
</h2>
<p>Performing a decoding analysis involves several steps:</p>
<ol style="list-style-type: decimal">
<li><p>Creating a datasource (DS) object that generates training and
test splits of the data.</p></li>
<li><p>Optionally creating feature-preprocessor (FP) objects that learn
parameters from the training data, and preprocess the training and test
data.</p></li>
<li><p>Creating a classifier (CL) object that learns the relationship
between the training data and training labels, and then evaluates the
strength of this relationship on the test data.</p></li>
<li><p>Creating result metric (RM) objects that aggregate the
predictions to create result summaries.</p></li>
<li><p>Running a cross-validator object that using the datasource (DS),
the feature-preprocessor (FP) and the classifier (CL) objects to do a
cross-validation procedure that estimates the decoding
accuracy.</p></li>
</ol>
<p>Below, we describe how to create and run these objects on the
Zhang-Desimone dataset.</p>
<div class="section level3">
<h3 id="creating-a-datasource-ds">Creating a Datasource (DS)<a class="anchor" aria-label="anchor" href="#creating-a-datasource-ds"></a>
</h3>
<p>A datasource object is used by the cross-validator to generate
training and test splits of the data. Below we create a
<code><a href="../reference/ds_basic.html">ds_basic()</a></code> object that takes binned-format data, name of
the label variables to be decoded, and a scalar that specifies how many
cross-validation splits to use. The default behavior of this datasource
is to create test splits that have one example of each object in them
and <em>num_cv_splits - 1</em> examples of each object in the training
set.</p>
<p>As calculated above, all 132 neurons have 59 repetitions of each
stimulus, and 125 neurons have 60 repetitions of each stimulus. Thus, we
can use up to 59 cross-validation splits using all neurons, or we could
set the datasource to use only a subset of neurons and use 60
cross-validation splits. For the purpose of this tutorial, we will use
all the neurons and only 20 cross-validation splits so the code runs a
little faster. The <code><a href="../reference/ds_basic.html">ds_basic()</a></code> datasource object also has
many more properties that can be set, including specifying certain label
levels or neurons to use.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binned_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ZD_150bins_50sampled.Rda"</span><span class="op">)</span>,</span>
<span>                                package<span class="op">=</span><span class="st">"NeuroDecodeR"</span><span class="op">)</span></span>
<span><span class="va">variable_to_decode</span> <span class="op">&lt;-</span> <span class="st">"stimulus_ID"</span></span>
<span><span class="va">num_cv_splits</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span>  </span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds_basic.html">ds_basic</a></span><span class="op">(</span><span class="va">binned_file_name</span>, <span class="va">variable_to_decode</span>, <span class="va">num_cv_splits</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Automatically selecting sites_IDs_to_use. Since num_cv_splits = 20 and num_label_repeats_per_cv_split = 1, all sites that have 20 repetitions have been selected. This yields 132 sites that will be used for decoding (out of 132 total).</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-a-feature-preprocessor-fp">Creating a feature-preprocessor (FP)<a class="anchor" aria-label="anchor" href="#creating-a-feature-preprocessor-fp"></a>
</h3>
<p>Feature preprocessors use the training set to learn particular
parameters about the data, and then apply preprocessing to the training
and test sets using these parameters. Below, we will create a
<code><a href="../reference/fp_zscore.html">fp_zscore()</a></code> preprocessor that zscore normalizes the data so
that each neuron’s activity has approximately zero mean and a standard
deviation of 1 over all trials. This feature-preprocessor is useful so
that neurons with high firing rates do not end up contributing more to
the decoding results than neurons with lower firing rates when a
<code><a href="../reference/cl_max_correlation.html">cl_max_correlation()</a></code> classifier is used.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note that the FP objects are stored in a list</span></span>
<span><span class="co">#  which allows multiple FP objects to be used in one analysis</span></span>
<span> </span>
<span><span class="va">fps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/fp_zscore.html">fp_zscore</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-classifier-cl">Creating a classifier (CL)<a class="anchor" aria-label="anchor" href="#creating-a-classifier-cl"></a>
</h3>
<p>Classifiers take a <em>training set</em> of data and learn the
relationship between the neural responses and the experimental
conditions (label levels) that were present on particular trials. The
classifier is then used to make predictions about what experimental
conditions are present on trials from a different <em>test set</em> of
neural data. Below, we create a <code><a href="../reference/cl_max_correlation.html">cl_max_correlation()</a></code>
classifier which learns prototypes of each class k that consists of the
mean of all training data from class k. The predicted class for a new
test point x is the class that has the maximum correlation coefficient
value between the x and each class prototype.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cl_max_correlation.html">cl_max_correlation</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-result-metrics-rm">Creating result metrics (RM)<a class="anchor" aria-label="anchor" href="#creating-result-metrics-rm"></a>
</h3>
<p>Result metrics take the predictions made by a classifier, as well as
the ground truth (i.e., the actual label level values for what happened
on each trial) and aggregate these predictions to give a measure of the
classifier’s performance.</p>
<p>Below, we create two result metrics. The first result metric returns
basic measures of decoding accuracy such as the proportion of
predictions that were correct (zero-one-loss). The second result metric
creates a confusion matrix showing the pattern of prediction mistakes
that were made. Result metrics must also be put into a list so multiple
result metrics can be used in an analysis.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="../reference/rm_main_results.html">rm_main_results</a></span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="../reference/rm_confusion_matrix.html">rm_confusion_matrix</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="creating-a-cross-validator-cv">Creating a cross-validator (CV)<a class="anchor" aria-label="anchor" href="#creating-a-cross-validator-cv"></a>
</h3>
<p>Cross-validator objects take a datasource, a classifier, result
metrics and optionally feature-preprocessor objects, and run a decoding
procedure by generating training and test data from the datasource,
preprocessing this data with the feature-preprocessors, training and
testing the classifier on the resulting data, and aggregating the
results with the result metrics. This procedure is run in two nested
loops. The inner ‘cross-validation’ loop runs a cross-validation
procedure where the classifier is trained and tested on different
divisions of the data. The outer, ‘resample’ loop generates new splits
(and potentially pseudo-populations) of data, which are then run in a
cross-validation procedure by the inner loop. The number of resample
runs is a parameter for this analysis as well, which we have set to 2 to
make the procedure run quicker, although in general more resample runs
will yield smoother results (the default value is 50).</p>
<p>Below, we create a <code><a href="../reference/cv_standard.html">cv_standard()</a></code> object to runs this
decoding procedure.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_standard.html">cv_standard</a></span><span class="op">(</span>datasource <span class="op">=</span> <span class="va">ds</span>, </span>
<span>                  classifier <span class="op">=</span> <span class="va">cl</span>, </span>
<span>                  feature_preprocessors <span class="op">=</span> <span class="va">fps</span>, </span>
<span>                  result_metrics <span class="op">=</span> <span class="va">rms</span>, </span>
<span>                  num_resample_runs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="running-the-decoding-analysis">Running the decoding analysis<a class="anchor" aria-label="anchor" href="#running-the-decoding-analysis"></a>
</h3>
<p>To run the decoding procedure, we call the cross-validator’s
run_cv_decoding method, and the results are stored in an object
DECODING_RESULTS.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DECODING_RESULTS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_decoding.html">run_decoding</a></span><span class="op">(</span><span class="va">cv</span><span class="op">)</span></span></code></pre></div>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="plotting-the-results">Plotting the results<a class="anchor" aria-label="anchor" href="#plotting-the-results"></a>
</h2>
<p>The DECODING_RESULTS object created is a list that contains our
result metrics, calculated by aggregating the results over all the
cross-validation splits. We can now use the result metrics plot
functions to visualize these aggregated results.</p>
<div class="section level3">
<h3 id="plotting-the-main-results">Plotting the main results<a class="anchor" aria-label="anchor" href="#plotting-the-main-results"></a>
</h3>
<p>The <code><a href="../reference/rm_main_results.html">rm_main_results()</a></code> plot function allows one to plot
temporal cross decoding results, where we are training the classifier at
one time and testing the classifier at a second time. This can be
displayed by running the code below:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span><span class="op">$</span><span class="va">rm_main_results</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/plot_tcd-1.png" width="700"></p>
<p>We can also create simpler line plots by setting the
<code>type = 'line'</code>. Additionally, we can plot all three types of
results that that rm_main_results object saves using the
<code>type = 'all'</code> argument. Below, we see the results by setting
both these arguments.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span><span class="op">$</span><span class="va">rm_main_results</span>, results_to_show <span class="op">=</span> <span class="st">'all'</span>, type <span class="op">=</span> <span class="st">'line'</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/plot_line-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plotting-confusion-matrices">Plotting confusion matrices<a class="anchor" aria-label="anchor" href="#plotting-confusion-matrices"></a>
</h3>
<p>We can also plot the confusion matrices aggregated from the
rm_confusion_matrix object, which shows the pattern of classification
mistakes at different points in time.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span><span class="op">$</span><span class="va">rm_confusion_matrix</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/plot_confusion_matrix-1.png" width="700"></p>
<p>The <code><a href="../reference/rm_confusion_matrix.html">rm_confusion_matrix()</a></code> object also has a function
<code>plot_MI()</code> which calculates mutual information from the
confusion matrix and plots this as a function of time or as a TCT
plot.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span><span class="op">$</span><span class="va">rm_confusion_matrix</span>, results_to_show <span class="op">=</span> <span class="st">"mutual_information"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/plot_MI-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="saving-the-results">Saving the results<a class="anchor" aria-label="anchor" href="#saving-the-results"></a>
</h2>
<p>Finally, the NDR has a “log” function that helps you save and manage
your results. Below, we show how to use the
<code><a href="../reference/log_save_results.html">log_save_results()</a></code> function which takes a
<code>DECODING_RESULTS</code> object and the name of a directory. This
function saves the results to the specified directory and logs the
parameters used in the analysis so that they can later be retrieved. For
more information, see the tutorial on saving and managing results.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_dir_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"results"</span>, <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">results_dir_name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/log_save_results.html">log_save_results</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span>, <span class="va">results_dir_name</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in log_save_results(DECODING_RESULTS, results_dir_name): The manifest file does not exist.</span></span>
<span><span class="co">##   Assuming this is the first result that is saved and creating manifest file</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="running-an-analysis-using-the-pipe-operator">Running an analysis using the pipe (|&gt;) operator<a class="anchor" aria-label="anchor" href="#running-an-analysis-using-the-pipe-operator"></a>
</h2>
<p>It is also possible to run a decoding analysis by string together NDR
objects using the pipe operator. One can do this with the following
steps:</p>
<ol style="list-style-type: decimal">
<li>Start by piping data in binned format into a datasource.</li>
<li>Pipe the datasource into a sequence that contains a classifier, and
optionally feature preprocessors and result metrics.</li>
<li>Pipe this sequence into a cross-validator and then call the
<code><a href="../reference/run_decoding.html">run_decoding()</a></code> method.</li>
</ol>
<p>The code below gives and example of how this can be done.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basedir_file_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"ZD_500bins_500sampled.Rda"</span><span class="op">)</span>, </span>
<span>                                   package<span class="op">=</span><span class="st">"NeuroDecodeR"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">DECODING_RESULTS</span> <span class="op">&lt;-</span> <span class="va">basedir_file_name</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/ds_basic.html">ds_basic</a></span><span class="op">(</span><span class="st">'stimulus_ID'</span>, <span class="fl">6</span>, num_label_repeats_per_cv_split <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/cl_max_correlation.html">cl_max_correlation</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/fp_zscore.html">fp_zscore</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/rm_main_results.html">rm_main_results</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/rm_confusion_matrix.html">rm_confusion_matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/cv_standard.html">cv_standard</a></span><span class="op">(</span>num_resample_runs <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/run_decoding.html">run_decoding</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Automatically selecting sites_IDs_to_use. Since num_cv_splits = 6 and num_label_repeats_per_cv_split = 3, all sites that have 18 repetitions have been selected. This yields 132 sites that will be used for decoding (out of 132 total).</span></span></code></pre>
<pre><code>## 
  |                                                                            
  |                                                                      |   0%
  |                                                                            
  |===================================                                   |  50%
  |                                                                            
  |======================================================================| 100%</code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">DECODING_RESULTS</span><span class="op">$</span><span class="va">rm_confusion_matrix</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction_tutorial_files/figure-html/ndr_piping_example-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Ethan Meyers.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
